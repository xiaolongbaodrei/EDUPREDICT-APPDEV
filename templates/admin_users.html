{% extends 'base.html' %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h3 class="mb-0">Manage Users</h3>
  <a class="btn btn-sm btn-outline-secondary" href="/dashboard">Back to Dashboard</a>
</div>

<table class="table table-striped">
  <thead>
    <tr><th>ID</th><th>Username</th><th>Role</th><th>Actions</th></tr>
  </thead>
  <tbody>
  {% for u in users %}
  <tr>
    <td>{{ u.id }}</td>
    <td>{{ u.username }}</td>
    <td>{{ u.role }}</td>
    <td class="actions-cell text-end">
      <div class="actions-wrap">
        <form method="POST" action="/admin/users/role/{{ u.id }}" class="m-0 confirmable" data-confirm="Change role for {{ u.username }} to {role}?">
          <input type="hidden" name="_requires_confirm" value="1">
          <select class="form-select form-select-sm d-inline w-auto" name="role">
            <option value="Teacher" {% if u.role=='Teacher' %}selected{% endif %}>Teacher</option>
            <option value="Admin" {% if u.role=='Admin' %}selected{% endif %}>Admin</option>
          </select>
          <button class="btn btn-sm btn-secondary" type="submit">Change</button>
        </form>
        {% if u.username != session.get('user') %}
        <form method="POST" action="/admin/users/delete/{{ u.id }}" class="m-0 confirmable" data-confirm="Delete user {{ u.username }}?">
          <input type="hidden" name="_requires_confirm" value="1">
          <button class="btn btn-sm btn-danger" type="submit">Delete</button>
        </form>
        {% endif %}
      </div>
    </td>
  </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}